const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./utils-MavFLS0Z.js","./vendor-BEryHLmj.js"])))=>i.map(i=>d[i]);
import{r as x,b as W,R as I}from"./vendor-BEryHLmj.js";import{C as H}from"./utils-MavFLS0Z.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&n(m)}).observe(document,{childList:!0,subtree:!0});function a(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=a(r);fetch(r.href,s)}})();var A={exports:{}},$={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var P=x,D=Symbol.for("react.element"),M=Symbol.for("react.fragment"),B=Object.prototype.hasOwnProperty,q=P.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,F={key:!0,ref:!0,__self:!0,__source:!0};function O(t,l,a){var n,r={},s=null,m=null;a!==void 0&&(s=""+a),l.key!==void 0&&(s=""+l.key),l.ref!==void 0&&(m=l.ref);for(n in l)B.call(l,n)&&!F.hasOwnProperty(n)&&(r[n]=l[n]);if(t&&t.defaultProps)for(n in l=t.defaultProps,l)r[n]===void 0&&(r[n]=l[n]);return{$$typeof:D,type:t,key:s,ref:m,props:r,_owner:q.current}}$.Fragment=M;$.jsx=O;$.jsxs=O;A.exports=$;var e=A.exports,R={},k=W;R.createRoot=k.createRoot,R.hydrateRoot=k.hydrateRoot;const U=({children:t})=>e.jsx("div",{className:"main-layout",children:e.jsx("div",{className:"main-layout__container",children:t})}),J=()=>{const[t,l]=x.useState(new Date);x.useEffect(()=>{const n=setInterval(()=>{l(new Date)},1e3);return()=>clearInterval(n)},[]);const a=n=>{const r=n.getFullYear(),s=String(n.getMonth()+1).padStart(2,"0"),m=String(n.getDate()).padStart(2,"0"),u=String(n.getHours()).padStart(2,"0"),f=String(n.getMinutes()).padStart(2,"0"),_=String(n.getSeconds()).padStart(2,"0");return`${r}-${s}-${m} ${u}:${f}:${_}`};return e.jsx("header",{className:"header main-layout__header",children:e.jsx("div",{className:"header__content",children:e.jsx("div",{className:"header__time",children:a(t)})})})},G="modulepreload",V=function(t,l){return new URL(t,l).href},T={},Y=function(l,a,n){let r=Promise.resolve();if(a&&a.length>0){const m=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),f=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));r=Promise.allSettled(a.map(_=>{if(_=V(_,n),_ in T)return;T[_]=!0;const p=_.endsWith(".css"),j=p?'[rel="stylesheet"]':"";if(!!n)for(let c=m.length-1;c>=0;c--){const d=m[c];if(d.href===_&&(!p||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${_}"]${j}`))return;const h=document.createElement("link");if(h.rel=p?"stylesheet":G,p||(h.as="script"),h.crossOrigin="",h.href=_,f&&h.setAttribute("nonce",f),document.head.appendChild(h),p)return new Promise((c,d)=>{h.addEventListener("load",c),h.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${_}`)))})}))}function s(m){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=m,window.dispatchEvent(u),!u.defaultPrevented)throw m}return r.then(m=>{for(const u of m||[])u.status==="rejected"&&s(u.reason);return l().catch(s)})},z=({isOpen:t,onClose:l,title:a,children:n})=>{x.useEffect(()=>{const s=m=>{m.key==="Escape"&&l()};return t&&(document.addEventListener("keydown",s),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",s),document.body.style.overflow="unset"}},[t,l]);const r=s=>{s.target===s.currentTarget&&l()};return t?e.jsx("div",{className:`modal__overlay ${t?"modal__overlay--active":""}`,onClick:r,children:e.jsxs("div",{className:"modal__content",children:[e.jsxs("div",{className:"modal__header",children:[e.jsx("h3",{className:"modal__title",children:a}),e.jsx("button",{className:"modal__close",onClick:l,"aria-label":"關閉對話框",children:"×"})]}),e.jsx("div",{className:"modal__body",children:n})]})}):null},K=({nameList:t,setNameList:l,onNameListChange:a,isLotteryInProgress:n})=>{const[r,s]=x.useState(!1),[m,u]=x.useState(""),[f,_]=x.useState(!0),p=()=>{if(!m.trim())return;let c=m.split(/[,\n]/).map(d=>d.trim()).filter(d=>d.length>0);if(c.length>0){let d=[...t,...c],i=0,o=c.length;if(f){const v=d.length;d=[...new Set(d)],i=v-d.length,o=d.length-t.length}l(d),a&&a(),u(""),s(!1),i>0?alert(`成功新增 ${o} 個名單，已排除 ${i} 個重複名稱`):o>0&&alert(`成功新增 ${o} 個名單`)}},j=c=>{const d=t.filter((i,o)=>o!==c);l(d),a&&a()},g=()=>{window.confirm("確定要清除所有名單嗎？")&&(l([]),a&&a())},h=c=>{const d=c.target.files[0];d&&(c.target.value="",Y(async()=>{const{Workbook:i}=await import("./utils-MavFLS0Z.js").then(o=>o.e);return{Workbook:i}},__vite__mapDeps([0,1]),import.meta.url).then(({Workbook:i})=>{const o=new FileReader;o.onload=async v=>{try{const y=new i;await y.xlsx.load(v.target.result);const E=y.getWorksheet(1),w=[];if(E.eachRow((N,b)=>{if(b>0){const S=N.getCell(1).value;if(S&&typeof S=="string"){const C=S.trim();C&&w.push(C)}}}),w.length>0){let N=[...t,...w],b=0,S=w.length;if(f){const C=N.length;N=[...new Set(N)],b=C-N.length,S=N.length-t.length}l(N),a&&a(),b>0?alert(`成功匯入 ${S} 個名單，已排除 ${b} 個重複名稱`):alert(`成功匯入 ${S} 個名單`)}else alert("Excel 檔案中沒有找到有效的名單")}catch(y){console.error("Excel import error:",y),alert("Excel 檔案讀取失敗，請確認檔案格式正確")}},o.readAsArrayBuffer(d)}).catch(i=>{console.error("ExcelJS import error:",i),alert("Excel 功能載入失敗")}))};return e.jsxs("div",{className:"namelist main-layout__namelist",children:[e.jsxs("div",{className:"namelist__header",children:[e.jsx("h2",{className:"namelist__title",children:"待抽獎名單"}),e.jsxs("div",{className:"namelist__actions",children:[e.jsx("button",{className:"btn btn--primary btn--small",onClick:()=>s(!0),disabled:n,children:"新增"}),e.jsxs("label",{className:`btn btn--secondary btn--small ${n?"btn--disabled":""}`,children:["匯入",e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:h,style:{display:"none"},disabled:n})]}),e.jsx("button",{className:"btn btn--secondary btn--small",onClick:g,disabled:t.length===0||n,children:"一鍵清除"})]}),e.jsx("div",{className:"namelist__settings",children:e.jsxs("label",{className:"namelist__checkbox",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:c=>_(c.target.checked),disabled:n}),e.jsx("span",{className:"namelist__checkbox-text",children:"自動排除重複名稱"})]})})]}),e.jsx("div",{className:"namelist__content",children:t.length===0?e.jsx("div",{className:"namelist__empty",children:e.jsx("p",{children:"尚無名單，請新增或匯入名單"})}):e.jsx("ul",{className:"list namelist__list",children:t.map((c,d)=>e.jsxs("li",{className:"list__item",children:[e.jsxs("div",{className:"list__content",children:[e.jsx("span",{className:"list__number",children:d+1}),e.jsx("span",{className:"list__name",children:c})]}),e.jsx("div",{className:"list__actions",children:e.jsx("button",{className:"list__remove",onClick:()=>j(d),disabled:n,children:"移除"})})]},`${c}-${d}`))})}),e.jsxs(z,{isOpen:r&&!n,onClose:()=>s(!1),title:"新增名單",children:[e.jsxs("div",{className:"form__group",children:[e.jsx("label",{className:"form__label",children:"輸入名單 (可使用逗號或換行分隔多個名單)"}),e.jsx("textarea",{className:"form__textarea",value:m,onChange:c=>u(c.target.value),placeholder:`請輸入名單，例如：
張三
李四
或者：張三,李四`,rows:6,disabled:n}),e.jsxs("div",{className:"form__help",children:[e.jsx("span",{className:"form__help-text",children:"提示：可以使用逗號(,)或換行符號來一次新增多筆名單"}),f&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{className:"form__help-enabled",children:"✅ 已啟用自動排除重複名稱"})]})]})]}),e.jsxs("div",{className:"modal__footer",children:[e.jsx("button",{className:"btn btn--secondary",onClick:()=>s(!1),children:"取消"}),e.jsx("button",{className:"btn btn--primary",onClick:p,disabled:!m.trim()||n,children:"確認新增"})]})]})]})},Q=({nameList:t,seedChanged:l,seedData:a,onStartLottery:n})=>{const[r,s]=x.useState(!1),[m,u]=x.useState([]),[f,_]=x.useState(!1),[p,j]=x.useState(null);x.useEffect(()=>{},[t]);const g=()=>{if(t.length===0){alert("請先新增名單");return}if(!a||l){alert("請先生成種子碼");return}s(!0),_(!1),j(null),n&&n();const h=a.winnerIndex,c=t[h];setTimeout(()=>{_(!0);const d=document.querySelector(".reel-container-inner");if(d){const i=window.innerWidth>=768?80:60,o=window.innerWidth>=768?400:300,v=Math.floor(o/2/i),y=t.findIndex(b=>b===c),N=25*t.length+y-v;d.style.setProperty("--winner-position",N),d.style.setProperty("--item-height",`${i}px`),d.classList.add("reel-stopping")}setTimeout(()=>{s(!1),j(c),setTimeout(()=>{const i=document.getElementById("winner-item"),o=document.getElementById("final-reel-state");if(i&&o){const v=o.offsetHeight,y=i.offsetTop,E=i.offsetHeight,w=y-v/2+E/2;o.scrollTo({top:w,behavior:"smooth"})}setTimeout(()=>{n&&n("reveal")},1e3)},100)},2e3)},8e3)};return e.jsx("div",{className:"lottery-section main-layout__lottery",children:e.jsxs("div",{className:"lottery-section__content",children:[e.jsx("h2",{className:"lottery-section__title",children:"抽獎輪盤"}),e.jsx("div",{className:"lottery-section__reel",children:e.jsx("div",{className:"reel-container",children:e.jsx("div",{className:"reel-frame",children:e.jsx("div",{className:"reel-window",children:r?e.jsx("div",{className:"reel-spinning",children:e.jsx("div",{className:`reel-container-inner ${f?"reel-stopping":""}`,"data-winner-index":a==null?void 0:a.winnerIndex,style:{"--name-count":t.length},children:Array.from({length:50},(h,c)=>e.jsx("div",{className:"reel-cycle",children:t.map((d,i)=>e.jsx("div",{className:"reel-item",children:d},`${c}-${i}`))},c))})}):p?e.jsx("div",{className:"reel-static",children:e.jsxs("div",{className:"reel-final-state",id:"final-reel-state",children:[e.jsx("div",{className:"reel-cycle-final",children:t.map((h,c)=>e.jsx("div",{className:"reel-final-item",children:h},`final-pre-${c}`))}),e.jsx("div",{className:"reel-main-final",children:t.map((h,c)=>e.jsx("div",{className:`reel-final-item ${h===p?"reel-final-item--winner":""}`,id:h===p?"winner-item":"",children:h},`final-main-${c}`))}),e.jsx("div",{className:"reel-cycle-final",children:t.map((h,c)=>e.jsx("div",{className:"reel-final-item",children:h},`final-post-${c}`))})]})}):e.jsx("div",{className:"reel-static",children:e.jsx("div",{className:"reel-preview-container",children:t.length>0?e.jsxs("div",{className:"reel-preview-list",children:[e.jsxs("div",{className:"reel-preview__header",children:[e.jsx("div",{className:"reel-preview__title",children:"參與名單"}),e.jsxs("div",{className:"reel-preview__count",children:[t.length," 人"]})]}),e.jsx("div",{className:"reel-preview__all-names",children:t.map((h,c)=>e.jsxs("div",{className:"reel-preview__name-item",children:[e.jsx("span",{className:"reel-preview__number",children:c+1}),e.jsx("span",{className:"reel-preview__name",children:h})]},c))})]}):e.jsx("div",{className:"reel-preview__empty",children:"請先新增名單"})})})})})})}),e.jsxs("div",{className:"lottery-section__controls",children:[e.jsx("button",{className:`btn btn--primary btn--large ${r?"btn--drawing":""}`,onClick:g,disabled:r||t.length===0||!a||l,children:r?"抽獎中...":"開始抽獎"}),r&&e.jsxs("div",{className:"lottery-section__progress",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill"})}),e.jsx("p",{children:"抽獎進行中，請稍候..."})]})]})]})})},X=()=>{const t="0123456789abcdef";let l="";for(let a=0;a<8;a++)l+=t[Math.floor(Math.random()*t.length)];return l},Z=t=>{const l=X(),a=Date.now(),n=Math.floor(Math.random()*t)+1,r=`${l}_${n}_${a}`,s=H.SHA256(r).toString();return{rawSeed:r,hashedSeed:s,randomHex:l,winnerNumber:n,winnerIndex:n-1,timestamp:a}},L=({nameList:t,onSeedGenerated:l,seedChanged:a,setSeedChanged:n,isLotteryInProgress:r})=>{const[s,m]=x.useState(null),[u,f]=x.useState(!1),[_,p]=x.useState(""),j=()=>{if(t.length===0){alert("請先新增名單再生成種子碼");return}const i=Z(t.length);m(i),f(!1),p(""),n(!1),l&&l(i)};I.useEffect(()=>{const i=()=>{if(s&&t.length>0){f(!0);const v=t[s.winnerIndex];p(v||"未知")}},o=document.querySelector(".seedcode-section");return o&&o.addEventListener("revealWinner",i),()=>{o&&o.removeEventListener("revealWinner",i)}},[s,t]);const g=()=>{if(_){const i=`中獎者: ${_} (第 ${s==null?void 0:s.winnerNumber} 號)`;navigator.clipboard.writeText(i).then(()=>{alert("中獎結果已複製到剪貼簿！")}).catch(()=>{const o=document.createElement("textarea");o.value=i,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),alert("中獎結果已複製到剪貼簿！")})}},h=i=>{i&&navigator.clipboard.writeText(i).then(()=>{alert("兌獎碼已複製到剪貼簿！")}).catch(()=>{const o=document.createElement("textarea");o.value=i,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),alert("兌獎碼已複製到剪貼簿！")})},c=i=>new Date(i).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),d=(i,o)=>{const v=i.split("_");return v.length!==3?i:e.jsxs("span",{children:[v[0],"_",e.jsx("span",{className:"seedcode__highlight",children:v[1]}),"_",v[2]]})};return e.jsxs("div",{className:"seedcode",children:[e.jsxs("div",{className:"seedcode__section",children:[e.jsx("h3",{className:"seedcode__title",children:"種子碼"}),e.jsx("div",{className:"seedcode__display",children:s?e.jsxs("div",{className:"seedcode__content",children:[e.jsxs("div",{className:"seedcode__hash",children:[e.jsx("label",{className:"seedcode__label",children:"SHA-256:"}),e.jsx("div",{className:"seedcode__value seedcode__value--hash",children:s.hashedSeed})]}),u&&e.jsxs("div",{className:"seedcode__raw",children:[e.jsx("label",{className:"seedcode__label",children:"兌獎碼:"}),e.jsxs("div",{className:"seedcode__value seedcode__value--raw",children:[d(s.rawSeed,s.winnerIndex),e.jsx("button",{className:"seedcode__copy-btn seedcode__copy-btn--inline",onClick:()=>h(s.rawSeed),title:"複製兌獎碼",children:"📋"})]}),e.jsxs("div",{className:"seedcode__breakdown",children:[e.jsxs("div",{className:"seedcode__part",children:[e.jsx("span",{className:"seedcode__part-label",children:"隨機碼:"}),e.jsx("span",{className:"seedcode__part-value",children:s.randomHex})]}),e.jsxs("div",{className:"seedcode__part",children:[e.jsx("span",{className:"seedcode__part-label",children:"中獎流水號:"}),e.jsx("span",{className:"seedcode__part-value seedcode__highlight",children:s.winnerNumber})]}),e.jsxs("div",{className:"seedcode__part",children:[e.jsx("span",{className:"seedcode__part-label",children:"時間戳:"}),e.jsx("span",{className:"seedcode__part-value",children:c(s.timestamp)})]})]})]})]}):e.jsx("div",{className:"seedcode__empty",children:e.jsx("p",{children:"尚未生成種子碼"})})})]}),e.jsxs("div",{className:"seedcode__section",children:[e.jsx("h3",{className:"seedcode__title",children:"開獎結果"}),e.jsx("div",{className:"seedcode__result",children:r?e.jsxs("div",{className:"seedcode__lottery-progress",children:[e.jsx("div",{className:"seedcode__progress-icon",children:"🎰"}),e.jsx("p",{children:"抽獎進行中..."}),e.jsx("div",{className:"seedcode__progress-text",children:"請等待抽獎完成"})]}):_?e.jsxs("div",{className:"seedcode__winner",children:[e.jsx("span",{className:"seedcode__winner-label",children:"中獎者:"}),e.jsx("span",{className:"seedcode__winner-name",children:_}),e.jsxs("span",{className:"seedcode__winner-number",children:["(第 ",s==null?void 0:s.winnerNumber," 號)"]}),e.jsx("button",{className:"seedcode__copy-btn",onClick:g,title:"複製中獎結果",children:"📋 複製"})]}):e.jsx("div",{className:"seedcode__no-result",children:e.jsx("p",{children:"尚未開獎"})})})]}),e.jsxs("div",{className:"seedcode__actions",children:[e.jsx("button",{className:"btn btn--secondary",onClick:j,disabled:t.length===0||r,children:s?"重新生成種子碼":"生成種子碼"}),a&&s&&e.jsx("div",{className:"seedcode__warning",children:"⚠️ 名單已異動，請重新生成種子碼"})]})]})},ee=({nameList:t,seedChanged:l,setSeedChanged:a,onSeedGenerated:n,seedData:r,isLotteryInProgress:s})=>e.jsx("div",{className:"seedcode-section main-layout__seedcode",children:e.jsxs("div",{className:"seedcode-section__content",children:[e.jsx("h2",{className:"seedcode-section__title",children:"種子碼與開獎"}),e.jsx(L,{nameList:t,onSeedGenerated:n,seedChanged:l,setSeedChanged:a,isLotteryInProgress:s})]})});function se(){const[t,l]=x.useState([]),[a,n]=x.useState(!1),[r,s]=x.useState(null),[m,u]=x.useState(!1),f=()=>{n(!0)},_=j=>{s(j)},p=j=>{if(j==="reveal"){u(!1);const g=document.querySelector(".seedcode-section");if(g){const h=new CustomEvent("revealWinner");g.dispatchEvent(h)}}else u(!0),console.log("抽獎開始！")};return e.jsxs(U,{children:[e.jsx(J,{}),e.jsx(ee,{nameList:t,seedChanged:a,setSeedChanged:n,onSeedGenerated:_,seedData:r,isLotteryInProgress:m}),e.jsx(Q,{nameList:t,seedChanged:a,seedData:r,onStartLottery:p}),e.jsx(K,{nameList:t,setNameList:l,onNameListChange:f,isLotteryInProgress:m})]})}R.createRoot(document.getElementById("root")).render(e.jsx(I.StrictMode,{children:e.jsx(se,{})}));
